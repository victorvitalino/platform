:css
  #map {
    width: 100%;
    height: 600px;
  }

%p
  %h1 
    %b Geolocalização Entidades
%br/
%br/

.row
  .col-md-12
    .panel.panel-default
      .panel-body
        %table.table.table-striped.table-bordered
          %thead
            %tr 
              %th Total
              %th Credenciadas
              %th Não Credenciadas
          %tbody
            %tr
              %td= @entities.count
              %td= @entities.where(situation_id: 1).count
              %td= @entities.where(situation_id: 0).count
.row
  .col-md-12
    #map

:javascript 
  var geocoder; 
  var map; 

  function initialize() {
    geocoder = new google.maps.Geocoder();
    var latlng = new google.maps.LatLng(-15.8091397,-47.8781489);
    var myOptions = {
      zoom: 10,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    map = new google.maps.Map(document.getElementById("map"), myOptions);
    
    $.getJSON("#{geo.entities_2016_entities_path}.json", function(data) {
      for(var i = 0; i < data.length; i++) {
        codeAddress(data[i])
      }
    });

  }

  function codeAddress(data) {
    
    var Latlng = new google.maps.LatLng(parseFloat(data.lat),parseFloat(data.lng));
    
    var marker = new google.maps.Marker({
        position: Latlng,
        map: map
    });

    var text = 'Credenciada'

    if(data.situation_id == 1) {
      marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png')
    } else {
      text = 'Não Credenciada'  
      marker.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png')
    }
  
    var contentString = "" +
    "<h4>"+ data.fantasy_name +"</h4>" +
    "<h5>"+ data.name +"</h5>" +
    "<h5>"+ data.cnpj +"</h5>" +
    "<hr/>" +
    "<h3>" + text + "</h3>"
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });

    marker.addListener('click', function() {
      infowindow.open(map, marker);
    });

  }
